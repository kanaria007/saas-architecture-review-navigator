# サービス間のデータ整合性が保証されているか？

> Type: Structure  
> Category: イベント・非同期処理  
> Audience: 設計初心者 / 設計中のチーム / レビュワー

---

## 背景・概要

**マイクロサービスや疎結合なシステム**では一貫性の保証が難しくなるため、設計段階で「いつ整合すべきか」を明確にする必要がある

---

## 例

- イベント駆動 + 結果整合性 な整合戦略を採用する
- あるステータスの更新をTaskサービス、Documentサービスの双方向で同期するのではなく、Taskサービスからのみ更新しDocumentサービスは購読するのみなどの**一方向のデータフロー**で整合性を確保する
- 更新後イベント送信＋受信側バリデーションにより不整合を防止する

---

## よくある失敗例

- 双方向更新でデータの整合が取れず、最新の情報が不明になる
- 処理順序が保証されておらず、古いイベントで上書きされる
- レプリカが遅延し、読み取りに誤差が出る

---

## FAQ

**Q. 結果整合性で本当に大丈夫？**

A. ケースバイケースだが、多くの業務は**即時一致よりも「ある程度の時間内で整合」で十分なことが多い**。それを考え定義してドキュメントに明記するのが重要

**Q. 双方向同期はやめるべき？**

A. 原則やめるべき。**一方通行の更新フロー**にしないと同期地獄になるので

---

## 関連観点

- [一貫性を担保するための分散トランザクションの必要性が整理されているか？](https://zenn.dev/kanaria007/articles/1b0505138cb47d)
- [非同期イベントの遅延やリトライ処理の影響を考慮した設計になっているか？](https://zenn.dev/kanaria007/articles/09bfba7fe29541)
- [依存する外部サービスの障害時の影響を考慮しているか？](https://zenn.dev/kanaria007/articles/c7769a08ffc3af)
- [非同期処理と同期処理の適用範囲が適切か？](https://zenn.dev/kanaria007/articles/fd762dcfb04e28)
